{% extends "base.html" %}

{% block title %}Utbyttekalender - Aksjeradar{% endblock %}

{% block content %}
{% include 'analysis/_menu.html' %}

<div class="container py-4">ds "base.html" %}

{% block title %}Utbyttekalender | Aksjeradar{% endblock %}

{% block content %}
{% include 'analysis/_menu.html' %}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="bi bi-calendar-check text-success"></i> Utbyttekalender
                    </h1>
                    <p class="text-muted">Oversikt over kommende utbyttebetalinger og ex-dividend datoer</p>
                </div>
            </div>
        </div>
    </div>

    {% if error %}
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle"></i> {{ error }}
    </div>
    {% endif %}

    <!-- Filter Section -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-funnel"></i> Filtere</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <label class="form-label">Periode</label>
                            <select class="form-select">
                                <option value="week" selected>Neste uke</option>
                                <option value="month">Neste måned</option>
                                <option value="quarter">Neste kvartal</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Min utbytteavkastning</label>
                            <select class="form-select">
                                <option value="">Alle</option>
                                <option value="3">3%+</option>
                                <option value="5">5%+</option>
                                <option value="7">7%+</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Marked</label>
                            <select class="form-select">
                                <option value="" selected>Alle markeder</option>
                                <option value="OSE">Oslo Børs</option>
                                <option value="US">Amerikanske aksjer</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary w-100" style="margin-top: 32px;">
                                <i class="bi bi-search"></i> Filtrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if dividend_events %}
    <!-- Dividend Calendar -->
    <div class="row">
        <div class="col-md-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header">
                    <h5 class="mb-0"><i class="bi bi-calendar3"></i> Kommende utbytter</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Selskap</th>
                                    <th>Symbol</th>
                                    <th>Ex-dividend dato</th>
                                    <th>Utbetalingsdato</th>
                                    <th>Beløp</th>
                                    <th>Avkastning</th>
                                    <th>Aksjon</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for event in dividend_events %}
                                <tr>
                                    <td>
                                        <strong>{{ event.company }}</strong>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('stocks.details', symbol=event.symbol) }}" class="text-decoration-none">
                                            {{ event.symbol }}
                                        </a>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary">{{ event.ex_date }}</span>
                                    </td>
                                    <td>{{ event.payment_date }}</td>
                                    <td>
                                        <strong>{{ event.amount }} {{ event.currency }}</strong>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if event.yield >= 6 %}bg-success
                                            {% elif event.yield >= 4 %}bg-warning
                                            {% else %}bg-secondary{% endif %}">
                                            {{ event.yield }}%
                                        </span>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-success btn-sm">
                                            <i class="bi bi-star"></i> Følg
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dividend Summary Stats -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h3 class="text-primary">{{ dividend_events|length }}</h3>
                    <p class="text-muted">Utbytter denne perioden</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h3 class="text-success">{{ "%.1f"|format((dividend_events|map(attribute='yield')|sum) / dividend_events|length) }}%</h3>
                    <p class="text-muted">Gjennomsnittlig avkastning</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h3 class="text-info">{{ "%.0f"|format(dividend_events|map(attribute='amount')|sum) }} NOK</h3>
                    <p class="text-muted">Total utbytteverdi</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h3 class="text-warning">{{ dividend_events|selectattr('yield', 'ge', 5)|list|length }}</h3>
                    <p class="text-muted">Høyavkastning (5%+)</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Educational Information -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h5><i class="bi bi-info-circle text-info"></i> Om utbytter</h5>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <h6><i class="bi bi-calendar-date text-primary"></i> Ex-dividend dato</h6>
                            <p class="small">Du må eie aksjen før denne datoen for å motta utbytte.</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="bi bi-cash-coin text-success"></i> Utbetalingsdato</h6>
                            <p class="small">Datoen da utbyttet faktisk betales til aksjonærene.</p>
                        </div>
                        <div class="col-md-4">
                            <h6><i class="bi bi-percent text-warning"></i> Utbytteavkastning</h6>
                            <p class="small">Årlig utbytte som prosent av aksjekursen.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center py-5">
        <i class="bi bi-calendar-check text-muted" style="font-size: 4rem;"></i>
        <h3 class="mt-3 text-muted">Ingen utbytter planlagt</h3>
        <p class="text-muted">Ingen utbyttebetalinger i den valgte perioden</p>
    </div>
    {% endif %}
</div>
{% endblock %}
