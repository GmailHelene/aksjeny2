{% extends "base.html" %}

{% block title %}Oslo BÃ¸rs Oversikt - Aksjeradar{% endblock %}

{% block content %}
    <div class="container mt-4">
        {% include 'analysis/_menu.html' %}
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3">
                <i class="bi bi-flag-fill text-primary me-2"></i>
                Oslo BÃ¸rs Oversikt
            </h1>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-primary btn-sm" onclick="location.reload()">
                    <i class="bi bi-arrow-clockwise"></i>
                    Oppdater
                </button>
            </div>
        </div>

        <!-- Market Summary Card -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="bi bi-graph-up me-2"></i>
                    Oslo BÃ¸rs Markedet
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center">
                            <h6 class="text-muted">Antall aksjer</h6>
                            <h4 class="text-primary">{{ oslo_stocks|length if oslo_stocks else 15 }}</h4>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <h6 class="text-muted">Siste oppdatering</h6>
                            <h6 class="text-success">{{ moment().format('HH:mm:ss') if moment else '15:30:00' }}</h6>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <h6 class="text-muted">Handelsvolum</h6>
                            <h6 class="text-info">HÃ¸y aktivitet</h6>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <h6 class="text-muted">Markedsstatus</h6>
                            <h6 id="oslo-market-status"></h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Oslo Stocks Table -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-table me-2"></i>
                    Oslo BÃ¸rs Aksjer
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>Aksje</th>
                                <th>Kurs (NOK)</th>
                                <th>Endring</th>
                                <th>Endring %</th>
                                <th>Volum</th>
                                <th>HÃ¸y</th>
                                <th>Lav</th>
                                <th>Signal</th>
                                <th>Handlinger</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% set oslo_data = {
                                'EQNR.OL': {'name': 'Equinor ASA', 'price': 342.55, 'change': 7.20, 'change_percent': 2.15, 'volume': 1850000, 'high': 345.20, 'low': 335.80, 'signal': 'BUY'},
                                'DNB.OL': {'name': 'DNB Bank ASA', 'price': 205.80, 'change': 1.05, 'change_percent': 0.51, 'volume': 950000, 'high': 207.50, 'low': 203.40, 'signal': 'HOLD'},
                                'TEL.OL': {'name': 'Telenor ASA', 'price': 142.60, 'change': -0.80, 'change_percent': -0.56, 'volume': 670000, 'high': 144.20, 'low': 141.90, 'signal': 'HOLD'},
                                'YAR.OL': {'name': 'Yara International', 'price': 398.50, 'change': 12.30, 'change_percent': 3.18, 'volume': 420000, 'high': 402.00, 'low': 385.70, 'signal': 'BUY'},
                                'MOWI.OL': {'name': 'Mowi ASA', 'price': 198.40, 'change': -3.60, 'change_percent': -1.78, 'volume': 580000, 'high': 202.80, 'low': 196.20, 'signal': 'SELL'},
                                'NHY.OL': {'name': 'Norsk Hydro ASA', 'price': 65.45, 'change': 0.52, 'change_percent': 0.80, 'volume': 2100000, 'high': 66.10, 'low': 64.85, 'signal': 'BUY'},
                                'AKERBP.OL': {'name': 'Aker BP ASA', 'price': 234.20, 'change': 5.80, 'change_percent': 2.54, 'volume': 730000, 'high': 236.40, 'low': 228.60, 'signal': 'BUY'},
                                'SALM.OL': {'name': 'SalMar ASA', 'price': 485.00, 'change': -8.50, 'change_percent': -1.72, 'volume': 190000, 'high': 495.00, 'low': 481.20, 'signal': 'HOLD'},
                                'SCHA.OL': {'name': 'Schibsted ASA', 'price': 287.50, 'change': 3.20, 'change_percent': 1.13, 'volume': 280000, 'high': 290.00, 'low': 284.10, 'signal': 'BUY'},
                                'AKER.OL': {'name': 'Aker ASA', 'price': 675.00, 'change': 15.50, 'change_percent': 2.35, 'volume': 150000, 'high': 680.00, 'low': 659.50, 'signal': 'BUY'},
                                'STB.OL': {'name': 'Storebrand ASA', 'price': 89.25, 'change': -0.45, 'change_percent': -0.50, 'volume': 320000, 'high': 90.10, 'low': 88.75, 'signal': 'HOLD'},
                                'KOG.OL': {'name': 'Kongsberg Gruppen', 'price': 1155.00, 'change': 25.00, 'change_percent': 2.21, 'volume': 95000, 'high': 1165.00, 'low': 1130.00, 'signal': 'BUY'},
                                'ODF.OL': {'name': 'Odfjell Drilling', 'price': 45.80, 'change': 1.20, 'change_percent': 2.69, 'volume': 180000, 'high': 46.50, 'low': 44.60, 'signal': 'BUY'},
                                'BWLPG.OL': {'name': 'BW LPG Limited', 'price': 125.40, 'change': -2.10, 'change_percent': -1.65, 'volume': 75000, 'high': 128.50, 'low': 124.20, 'signal': 'HOLD'},
                                'REC.OL': {'name': 'REC Silicon ASA', 'price': 12.85, 'change': 0.35, 'change_percent': 2.80, 'volume': 890000, 'high': 13.10, 'low': 12.50, 'signal': 'BUY'}
                            } %}
                            {% for ticker, data in oslo_data.items() %}
                            <tr>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="me-2">
                                            <span class="flag-icon">ðŸ‡³ðŸ‡´</span>
                                        </div>
                                        <div>
                                            <strong>{{ ticker }}</strong>
                                            <br>
                                            <small class="text-muted">{{ data.name }}</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <strong>{{ "{:.2f}".format(data.price) }}</strong>
                                </td>
                                <td>
                                    <span class="{% if data.change > 0 %}text-success{% else %}text-danger{% endif %}">
                                        {{ "{:+.2f}".format(data.change) }}
                                    </span>
                                </td>
                                <td>
                                    <span class="{% if data.change_percent > 0 %}text-success{% else %}text-danger{% endif %}">
                                        <i class="bi bi-{% if data.change_percent > 0 %}arrow-up{% else %}arrow-down{% endif %}"></i>
                                        {{ "{:+.2f}".format(data.change_percent) }}%
                                    </span>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {{ "{:,.0f}".format(data.volume) }}
                                    </small>
                                </td>
                                <td>
                                    <span class="text-success">{{ "{:.2f}".format(data.high) }}</span>
                                </td>
                                <td>
                                    <span class="text-danger">{{ "{:.2f}".format(data.low) }}</span>
                                </td>
                                <td>
                                    <span class="badge {% if data.signal == 'BUY' %}bg-success{% elif data.signal == 'SELL' %}bg-danger{% else %}bg-warning{% endif %}">
                                        {{ data.signal }}
                                    </span>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('stocks.details', symbol=ticker) }}" class="btn btn-outline-primary" title="Se detaljer">
                                            <i class="bi bi-info-circle"></i>
                                        </a>
                                        <a href="{{ url_for('analysis.technical', symbol=ticker) }}" class="btn btn-outline-success" title="Teknisk analyse">
                                            <i class="bi bi-graph-up"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Market Analysis Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-bar-chart me-2"></i>
                    Markedsanalyse - Oslo BÃ¸rs
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Dagens vinnere</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>ðŸ‡³ðŸ‡´ YAR.OL</span>
                                <span class="text-success">+3.18%</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>ðŸ‡³ðŸ‡´ REC.OL</span>
                                <span class="text-success">+2.80%</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>ðŸ‡³ðŸ‡´ ODF.OL</span>
                                <span class="text-success">+2.69%</span>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Dagens tapere</h6>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>ðŸ‡³ðŸ‡´ MOWI.OL</span>
                                <span class="text-danger">-1.78%</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>ðŸ‡³ðŸ‡´ SALM.OL</span>
                                <span class="text-danger">-1.72%</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between">
                                <span>ðŸ‡³ðŸ‡´ BWLPG.OL</span>
                                <span class="text-danger">-1.65%</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// Market status logic for Oslo BÃ¸rs
function updateOsloMarketStatus() {
    const marketStatus = document.getElementById('oslo-market-status');
    if (!marketStatus) return;

    const now = new Date();
    // Oslo BÃ¸rs: open 09:00 - 16:30, Monday-Friday
    const openHour = 9, openMinute = 0, closeHour = 16, closeMinute = 30;
    const weekday = now.getDay(); // 0=Sunday, 1=Monday, ..., 5=Friday, 6=Saturday
    let isOpen = false;
    
    if (weekday >= 1 && weekday <= 5) {
        const minutes = now.getHours() * 60 + now.getMinutes();
        const openMinutes = openHour * 60 + openMinute;
        const closeMinutes = closeHour * 60 + closeMinute;
        isOpen = minutes >= openMinutes && minutes < closeMinutes;
    }
    
    if (isOpen) {
        marketStatus.innerHTML = '<span class="badge bg-success">Ã…PEN</span><small class="d-block text-muted">09:00 - 16:30</small>';
        marketStatus.className = 'text-success';
    } else {
        marketStatus.innerHTML = '<span class="badge bg-danger">STENGT</span><small class="d-block text-muted">09:00 - 16:30</small>';
        marketStatus.className = 'text-danger';
    }
}

// Update market status when page loads
document.addEventListener('DOMContentLoaded', function() {
    updateOsloMarketStatus();
    // Update every minute
    setInterval(updateOsloMarketStatus, 60000);
});
</script>
{% endblock %}
