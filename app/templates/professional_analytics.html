<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Analytics Dashboard | AksjenyTips</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/professional-theme.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        .analytics-dashboard {
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-navy), var(--accent-teal));
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
        }

        .dashboard-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            color: white;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .analytics-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .analytics-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            width: 24px;
            height: 24px;
            color: var(--accent-teal);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-teal);
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-change {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .metric-change.positive {
            color: var(--success-color);
        }

        .metric-change.negative {
            color: var(--error-color);
        }

        .chart-container {
            width: 100%;
            height: 400px;
            margin-top: 20px;
        }

        .mini-chart {
            width: 100%;
            height: 200px;
            margin-top: 15px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th {
            background: var(--header-bg);
            color: var(--text-primary);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .data-table tr:hover {
            background: var(--hover-bg);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .status-stopped {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error-color);
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.2);
            color: var(--warning-color);
        }

        .pattern-item {
            background: var(--secondary-bg);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent-teal);
        }

        .pattern-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }

        .pattern-type {
            font-weight: 600;
            color: var(--text-primary);
        }

        .pattern-confidence {
            font-size: 0.9rem;
            padding: 2px 8px;
            border-radius: 12px;
            background: var(--accent-teal);
            color: white;
        }

        .pattern-bias {
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .bias-bullish {
            background: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }

        .bias-bearish {
            background: rgba(244, 67, 54, 0.2);
            color: var(--error-color);
        }

        .bias-neutral {
            background: rgba(158, 158, 158, 0.2);
            color: var(--text-secondary);
        }

        .alert-item {
            background: var(--secondary-bg);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 3px solid var(--warning-color);
        }

        .alert-message {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .alert-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .control-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .symbol-selector {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .symbol-button {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            background: var(--secondary-bg);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .symbol-button:hover,
        .symbol-button.active {
            background: var(--accent-teal);
            color: white;
            border-color: var(--accent-teal);
        }

        .timeframe-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .refresh-btn {
            background: var(--accent-teal);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: var(--primary-navy);
            transform: translateY(-1px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .loading.show {
            display: block;
        }

        @media (max-width: 1200px) {
            .analytics-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .symbol-selector {
                flex-wrap: wrap;
            }
            
            .dashboard-title {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="analytics-dashboard">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1 class="dashboard-title">
                <i class="fas fa-chart-line"></i>
                Professional Analytics Dashboard
            </h1>
            <p class="dashboard-subtitle">
                Advanced MT4-style trading analytics with Expert Advisors, pattern recognition, and risk management
            </p>
        </div>

        <!-- Control Panel -->
        <div class="control-panel">
            <div class="symbol-selector">
                <label>Symbol:</label>
                <button class="symbol-button active" data-symbol="EURUSD">EUR/USD</button>
                <button class="symbol-button" data-symbol="GBPUSD">GBP/USD</button>
                <button class="symbol-button" data-symbol="USDJPY">USD/JPY</button>
                <button class="symbol-button" data-symbol="GOLD">GOLD</button>
                <button class="symbol-button" data-symbol="SP500">S&P 500</button>
                <button class="symbol-button" data-symbol="BITCOIN">BITCOIN</button>
            </div>

            <div class="timeframe-selector">
                <label>Timeframe:</label>
                <button class="symbol-button active" data-timeframe="1H">1H</button>
                <button class="symbol-button" data-timeframe="4H">4H</button>
                <button class="symbol-button" data-timeframe="1D">1D</button>
            </div>

            <button class="refresh-btn" onclick="refreshDashboard()">
                <i class="fas fa-sync-alt"></i>
                Refresh Data
            </button>
        </div>

        <!-- Key Metrics Grid -->
        <div class="analytics-grid">
            <div class="analytics-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-line card-icon"></i>
                        Current Price
                    </h3>
                </div>
                <div class="metric-value" id="current-price">1.0852</div>
                <div class="metric-label">EUR/USD</div>
                <div class="metric-change positive" id="price-change">+0.0023 (+0.21%)</div>
            </div>

            <div class="analytics-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-robot card-icon"></i>
                        Expert Advisors
                    </h3>
                </div>
                <div class="metric-value" id="active-eas">3</div>
                <div class="metric-label">Active EAs</div>
                <div class="metric-change positive" id="ea-profit">+$1,247 Today</div>
            </div>

            <div class="analytics-card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-shield-alt card-icon"></i>
                        Risk Score
                    </h3>
                </div>
                <div class="metric-value" id="risk-score">24</div>
                <div class="metric-label">Low Risk</div>
                <div class="metric-change" id="risk-change">Within Limits</div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="main-grid">
            <!-- Left Column -->
            <div>
                <!-- Price Chart -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-candlestick card-icon"></i>
                            Price Chart & Technical Analysis
                        </h3>
                    </div>
                    <div class="chart-container" id="price-chart"></div>
                </div>

                <!-- Pattern Recognition -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-search card-icon"></i>
                            Pattern Recognition
                        </h3>
                    </div>
                    <div id="pattern-list">
                        <!-- Patterns will be loaded here -->
                    </div>
                </div>

                <!-- Expert Advisors Performance -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-robot card-icon"></i>
                            Expert Advisors Performance
                        </h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>EA Name</th>
                                <th>Status</th>
                                <th>Trades</th>
                                <th>Win Rate</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody id="ea-table">
                            <!-- EA data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Market Overview -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-globe card-icon"></i>
                            Market Overview
                        </h3>
                    </div>
                    <div id="market-overview">
                        <!-- Market data will be loaded here -->
                    </div>
                </div>

                <!-- Active Alerts -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-bell card-icon"></i>
                            Active Alerts
                        </h3>
                    </div>
                    <div id="alerts-list">
                        <!-- Alerts will be loaded here -->
                    </div>
                </div>

                <!-- Risk Management -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-shield-alt card-icon"></i>
                            Risk Management
                        </h3>
                    </div>
                    <div id="risk-metrics">
                        <!-- Risk metrics will be loaded here -->
                    </div>
                </div>

                <!-- Advanced Orders -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-list-ul card-icon"></i>
                            Advanced Orders
                        </h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Type</th>
                                <th>Price</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                </div>

                <!-- Performance Metrics -->
                <div class="analytics-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-bar card-icon"></i>
                            Performance Metrics
                        </h3>
                    </div>
                    <div class="mini-chart" id="performance-chart"></div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin"></i>
            Loading analytics data...
        </div>
    </div>

    <script>
        // Global variables
        let currentSymbol = 'EURUSD';
        let currentTimeframe = '1H';
        let priceChart = null;
        let refreshInterval = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            setupEventListeners();
            startAutoRefresh();
        });

        function initializeDashboard() {
            loadDashboardData();
        }

        function setupEventListeners() {
            // Symbol selection
            document.querySelectorAll('.symbol-button[data-symbol]').forEach(button => {
                button.addEventListener('click', function() {
                    // Update active symbol
                    document.querySelectorAll('.symbol-button[data-symbol]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentSymbol = this.getAttribute('data-symbol');
                    loadDashboardData();
                });
            });

            // Timeframe selection
            document.querySelectorAll('.symbol-button[data-timeframe]').forEach(button => {
                button.addEventListener('click', function() {
                    // Update active timeframe
                    document.querySelectorAll('.symbol-button[data-timeframe]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTimeframe = this.getAttribute('data-timeframe');
                    loadDashboardData();
                });
            });
        }

        function loadDashboardData() {
            showLoading(true);
            
            fetch(`/analytics/api/dashboard/${currentSymbol}/${currentTimeframe}`)
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                    showLoading(false);
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    showLoading(false);
                });
        }

        function updateDashboard(data) {
            // Update key metrics
            updateKeyMetrics(data);
            
            // Update price chart
            updatePriceChart(data.market_data);
            
            // Update pattern recognition
            updatePatterns(data.pattern_recognition);
            
            // Update Expert Advisors
            updateExpertAdvisors(data.expert_advisors);
            
            // Update market overview
            updateMarketOverview(data.market_overview);
            
            // Update alerts
            updateAlerts(data.alerts);
            
            // Update risk metrics
            updateRiskMetrics(data.risk_metrics);
            
            // Update advanced orders
            updateAdvancedOrders(data.advanced_orders);
            
            // Update performance chart
            updatePerformanceChart(data.performance_metrics);
        }

        function updateKeyMetrics(data) {
            const marketData = data.market_data;
            
            // Current price
            document.getElementById('current-price').textContent = marketData.current_price;
            
            // Price change
            const changeElement = document.getElementById('price-change');
            const changeText = `${marketData.change > 0 ? '+' : ''}${marketData.change} (${marketData.change_percent}%)`;
            changeElement.textContent = changeText;
            changeElement.className = `metric-change ${marketData.change >= 0 ? 'positive' : 'negative'}`;
            
            // Expert Advisors
            const eaData = data.expert_advisors;
            document.getElementById('active-eas').textContent = eaData.active_count;
            document.getElementById('ea-profit').textContent = `+$${eaData.total_profit_today.toFixed(2)} Today`;
            
            // Risk score
            const riskData = data.risk_metrics;
            document.getElementById('risk-score').textContent = riskData.risk_score;
        }

        function updatePriceChart(marketData) {
            // Create or update price chart using Lightweight Charts
            const chartContainer = document.getElementById('price-chart');
            
            if (priceChart) {
                priceChart.remove();
            }
            
            priceChart = LightweightCharts.createChart(chartContainer, {
                width: chartContainer.clientWidth,
                height: 400,
                layout: {
                    backgroundColor: '#1a1a1a',
                    textColor: '#ffffff',
                },
                grid: {
                    vertLines: {
                        color: '#2B2B43',
                    },
                    horzLines: {
                        color: '#2B2B43',
                    },
                },
                crosshair: {
                    mode: LightweightCharts.CrosshairMode.Normal,
                },
                rightPriceScale: {
                    borderColor: '#2B2B43',
                },
                timeScale: {
                    borderColor: '#2B2B43',
                },
            });

            const candlestickSeries = priceChart.addCandlestickSeries({
                upColor: '#26a69a',
                downColor: '#ef5350',
                borderVisible: false,
                wickUpColor: '#26a69a',
                wickDownColor: '#ef5350',
            });

            candlestickSeries.setData(marketData.chart_data);
        }

        function updatePatterns(patternData) {
            const patternList = document.getElementById('pattern-list');
            
            if (patternData.top_patterns && patternData.top_patterns.length > 0) {
                patternList.innerHTML = patternData.top_patterns.map(pattern => `
                    <div class="pattern-item">
                        <div class="pattern-header">
                            <div>
                                <span class="pattern-type">${pattern.type}</span>
                                <span class="pattern-bias bias-${pattern.bias.toLowerCase()}">${pattern.bias}</span>
                            </div>
                            <span class="pattern-confidence">${(pattern.confidence * 100).toFixed(0)}%</span>
                        </div>
                        <p style="margin: 0; font-size: 0.9rem; color: var(--text-secondary);">
                            ${pattern.description}
                        </p>
                        ${pattern.entry_price ? `
                            <div style="margin-top: 8px; font-size: 0.8rem;">
                                Entry: ${pattern.entry_price} | Target: ${pattern.target_price} | SL: ${pattern.stop_loss}
                            </div>
                        ` : ''}
                    </div>
                `).join('');
            } else {
                patternList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No patterns detected</p>';
            }
        }

        function updateExpertAdvisors(eaData) {
            const eaTable = document.getElementById('ea-table');
            
            if (eaData.expert_advisors && eaData.expert_advisors.length > 0) {
                eaTable.innerHTML = eaData.expert_advisors.map(ea => `
                    <tr>
                        <td>${ea.name}</td>
                        <td><span class="status-badge status-${ea.status.toLowerCase()}">${ea.status}</span></td>
                        <td>${ea.total_trades}</td>
                        <td>${(ea.win_rate * 100).toFixed(1)}%</td>
                        <td class="${ea.total_profit >= 0 ? 'positive' : 'negative'}">$${ea.total_profit.toFixed(2)}</td>
                    </tr>
                `).join('');
            } else {
                eaTable.innerHTML = '<tr><td colspan="5" style="text-align: center;">No Expert Advisors active</td></tr>';
            }
        }

        function updateMarketOverview(marketData) {
            const overview = document.getElementById('market-overview');
            
            overview.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: var(--text-primary);">Market Sentiment: 
                        <span style="color: var(--accent-teal);">${marketData.market_sentiment}</span>
                    </h4>
                    <p style="color: var(--text-secondary); margin: 0;">VIX: ${marketData.volatility_index}</p>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Major Indices</h5>
                    ${Object.entries(marketData.indices).map(([symbol, data]) => `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>${symbol}</span>
                            <span class="${data.change >= 0 ? 'positive' : 'negative'}">${data.value} (${data.change_pct > 0 ? '+' : ''}${data.change_pct}%)</span>
                        </div>
                    `).join('')}
                </div>
                
                <div>
                    <h5 style="color: var(--text-primary); margin-bottom: 8px;">Market News</h5>
                    ${marketData.market_news.slice(0, 3).map(news => `
                        <div style="margin-bottom: 8px; padding: 8px; background: var(--secondary-bg); border-radius: 6px;">
                            <div style="font-size: 0.9rem; font-weight: 500;">${news.title}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">${news.time}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function updateAlerts(alertsData) {
            const alertsList = document.getElementById('alerts-list');
            
            if (alertsData.recent_alerts && alertsData.recent_alerts.length > 0) {
                alertsList.innerHTML = alertsData.recent_alerts.slice(0, 5).map(alert => `
                    <div class="alert-item">
                        <div class="alert-message">${alert.message}</div>
                        <div class="alert-time">${new Date(alert.created_at).toLocaleString()}</div>
                    </div>
                `).join('');
            } else {
                alertsList.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No recent alerts</p>';
            }
        }

        function updateRiskMetrics(riskData) {
            const riskMetrics = document.getElementById('risk-metrics');
            
            riskMetrics.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <h5 style="color: var(--text-primary); margin-bottom: 10px;">Portfolio Risk</h5>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Sharpe Ratio:</span>
                        <span>${riskData.portfolio_metrics.sharpe_ratio.toFixed(2)}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Max Drawdown:</span>
                        <span>${(riskData.portfolio_metrics.max_drawdown * 100).toFixed(1)}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>VaR (95%):</span>
                        <span>${(riskData.value_at_risk.daily_var_95 * 100).toFixed(2)}%</span>
                    </div>
                </div>
                
                <div>
                    <h5 style="color: var(--text-primary); margin-bottom: 10px;">Position Sizing</h5>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Conservative:</span>
                        <span>${(riskData.position_sizing.conservative * 100).toFixed(1)}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Moderate:</span>
                        <span>${(riskData.position_sizing.moderate * 100).toFixed(1)}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Aggressive:</span>
                        <span>${(riskData.position_sizing.aggressive * 100).toFixed(1)}%</span>
                    </div>
                </div>
            `;
        }

        function updateAdvancedOrders(ordersData) {
            const ordersTable = document.getElementById('orders-table');
            
            if (ordersData.pending_orders && ordersData.pending_orders.length > 0) {
                ordersTable.innerHTML = ordersData.pending_orders.slice(0, 5).map(order => `
                    <tr>
                        <td>${order.symbol}</td>
                        <td>${order.type}</td>
                        <td>${order.price}</td>
                        <td><span class="status-badge status-${order.status.toLowerCase()}">${order.status}</span></td>
                    </tr>
                `).join('');
            } else {
                ordersTable.innerHTML = '<tr><td colspan="4" style="text-align: center;">No pending orders</td></tr>';
            }
        }

        function updatePerformanceChart(performanceData) {
            const ctx = document.getElementById('performance-chart');
            
            // Simple performance chart using Chart.js
            if (window.performanceChart) {
                window.performanceChart.destroy();
            }
            
            window.performanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Portfolio Return',
                        data: [2.3, 4.1, 6.8, 8.7],
                        borderColor: '#14b8a6',
                        backgroundColor: 'rgba(20, 184, 166, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#2B2B43'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        },
                        x: {
                            grid: {
                                color: '#2B2B43'
                            },
                            ticks: {
                                color: '#ffffff'
                            }
                        }
                    }
                }
            });
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            if (show) {
                loading.classList.add('show');
            } else {
                loading.classList.remove('show');
            }
        }

        function refreshDashboard() {
            loadDashboardData();
        }

        function startAutoRefresh() {
            // Refresh data every 30 seconds
            refreshInterval = setInterval(loadDashboardData, 30000);
        }

        // Handle window resize for charts
        window.addEventListener('resize', function() {
            if (priceChart) {
                priceChart.applyOptions({
                    width: document.getElementById('price-chart').clientWidth
                });
            }
        });
    </script>
</body>
</html>
