{% extends "base.html" %}
{% block title %}API Dokumentasjon - Aksjeradar{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ url_for('main.index') }}" class="text-decoration-none">
                    <i class="bi bi-house-door me-1"></i>Hjem
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                <i class="bi bi-code-slash me-1"></i>API Dokumentasjon
            </li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0">
                    <i class="bi bi-code-slash me-3"></i>API Dokumentasjon
                </h1>
                <span class="badge bg-primary fs-6">v1.0</span>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3">
            <!-- Sidebar Navigation -->
            <div class="card shadow-sm sticky-top">
                <div class="card-body">
                    <h5 class="card-title">Innhold</h5>
                    <nav class="nav flex-column">
                        <a class="nav-link" href="#overview">Oversikt</a>
                        <a class="nav-link" href="#authentication">Autentisering</a>
                        <a class="nav-link" href="#stocks">Aksjer API</a>
                        <a class="nav-link" href="#market">Markedsdata API</a>
                        <a class="nav-link" href="#portfolio">Portefølje API</a>
                        <a class="nav-link" href="#analysis">Analyse API</a>
                        <a class="nav-link" href="#errors">Feilhåndtering</a>
                    </nav>
                </div>
            </div>
        </div>

        <div class="col-lg-9">
            <!-- Overview Section -->
            <section id="overview" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-info-circle me-2"></i>Oversikt
                        </h2>
                        <p class="card-text">
                            Aksjeradar API gir tilgang til omfattende markedsdata, aksjeanalyser og porteføljeadministrasjon.
                            API-et er bygget med REST-prinsipper og returnerer JSON-format.
                        </p>
                        
                        <h4>Base URL</h4>
                        <div class="bg-light p-3 rounded">
                            <code>https://aksjeradar.trade/api</code>
                        </div>
                        
                        <h4 class="mt-4">Støttede formater</h4>
                        <ul>
                            <li>JSON (standard)</li>
                            <li>CSV (for enkelte endepunkter)</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Authentication Section -->
            <section id="authentication" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-shield-lock me-2"></i>Autentisering
                        </h2>
                        <p>Aksjeradar API bruker session-basert autentisering. Du må være logget inn for å få tilgang til beskyttede endepunkter.</p>
                        
                        <h4>Demo endepunkter</h4>
                        <p>Følgende endepunkter er tilgjengelige uten autentisering:</p>
                        <ul>
                            <li><code>GET /api/demo/stocks</code> - Demo aksjedata</li>
                            <li><code>GET /api/demo/market-data</code> - Demo markedsdata</li>
                            <li><code>GET /api/demo/portfolio</code> - Demo portefølje</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Stocks API Section -->
            <section id="stocks" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-graph-up me-2"></i>Aksjer API
                        </h2>
                        
                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Hent aksjedata</h4>
                                <div class="bg-light p-3 rounded mb-3">
                                    <code>GET /api/stocks/{symbol}</code>
                                </div>
                                <p>Henter detaljert informasjon om en spesifikk aksje.</p>
                                
                                <h5>Parametere</h5>
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Type</th>
                                            <th>Beskrivelse</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><code>symbol</code></td>
                                            <td>string</td>
                                            <td>Aksjesymbol (f.eks. EQNR.OL)</td>
                                        </tr>
                                    </tbody>
                                </table>
                                
                                <h5>Eksempel respons</h5>
                                <pre class="bg-light p-3 rounded"><code>{
  "success": true,
  "data": {
    "symbol": "EQNR.OL",
    "name": "Equinor ASA",
    "price": 342.55,
    "change": 7.12,
    "change_percent": 2.12,
    "volume": 2500000,
    "market_cap": 1100000000000,
    "pe_ratio": 12.4,
    "signal": "BUY"
  }
}</code></pre>
                            </div>
                        </div>

                        <div class="row mb-4">
                            <div class="col-12">
                                <h4>Søk aksjer</h4>
                                <div class="bg-light p-3 rounded mb-3">
                                    <code>GET /api/stocks/search?q={query}</code>
                                </div>
                                <p>Søker etter aksjer basert på navn eller symbol.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Market API Section -->
            <section id="market" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-globe me-2"></i>Markedsdata API
                        </h2>
                        
                        <h4>Markedsoversikt</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/market/overview</code>
                        </div>
                        <p>Henter omfattende markedsoversikt med Oslo Børs og globale markeder.</p>
                        
                        <h4>Oslo Børs</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/market/oslo</code>
                        </div>
                        <p>Henter data fra Oslo Børs.</p>
                        
                        <h4>Kryptovaluta</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/crypto/overview</code>
                        </div>
                        <p>Henter oversikt over kryptovalutaer.</p>
                    </div>
                </div>
            </section>

            <!-- Portfolio API Section -->
            <section id="portfolio" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-briefcase me-2"></i>Portefølje API
                        </h2>
                        
                        <h4>Hent portefølje</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/portfolio</code>
                        </div>
                        <p>Henter brukerens portefølje med alle beholdninger.</p>
                        
                        <h4>Legg til posisjon</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>POST /api/portfolio/add</code>
                        </div>
                        <p>Legger til en ny posisjon i porteføljen.</p>
                        
                        <h5>Request body</h5>
                        <pre class="bg-light p-3 rounded"><code>{
  "symbol": "EQNR.OL",
  "quantity": 100,
  "price": 342.55,
  "action": "buy"
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Analysis API Section -->
            <section id="analysis" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-bar-chart me-2"></i>Analyse API
                        </h2>
                        
                        <h4>Teknisk analyse</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/analysis/technical/{symbol}</code>
                        </div>
                        <p>Henter teknisk analyse for en aksje.</p>
                        
                        <h4>AI anbefalinger</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/analysis/ai/{symbol}</code>
                        </div>
                        <p>Henter AI-baserte anbefalinger for en aksje.</p>
                        
                        <h4>Innsidehandel</h4>
                        <div class="bg-light p-3 rounded mb-3">
                            <code>GET /api/insider/analysis/{symbol}</code>
                        </div>
                        <p>Henter innsidehandel-analyse for en aksje.</p>
                    </div>
                </div>
            </section>

            <!-- Error Handling Section -->
            <section id="errors" class="mb-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h2 class="card-title">
                            <i class="bi bi-exclamation-triangle me-2"></i>Feilhåndtering
                        </h2>
                        
                        <p>API-et bruker standard HTTP-statuskoder for å indikere suksess eller feil.</p>
                        
                        <h4>Statuskoder</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Beskrivelse</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><code>200</code></td>
                                    <td>OK - Forespørsel var vellykket</td>
                                </tr>
                                <tr>
                                    <td><code>400</code></td>
                                    <td>Bad Request - Ugyldig forespørsel</td>
                                </tr>
                                <tr>
                                    <td><code>401</code></td>
                                    <td>Unauthorized - Autentisering kreves</td>
                                </tr>
                                <tr>
                                    <td><code>404</code></td>
                                    <td>Not Found - Ressurs ikke funnet</td>
                                </tr>
                                <tr>
                                    <td><code>500</code></td>
                                    <td>Internal Server Error - Serverfeil</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <h4>Feilformat</h4>
                        <pre class="bg-light p-3 rounded"><code>{
  "success": false,
  "error": "Not Found",
  "message": "Aksje ikke funnet",
  "timestamp": "2024-01-15T10:30:00Z"
}</code></pre>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Update active nav item on scroll
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link[href^="#"]');
    
    function updateActiveNav() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop - 100;
            if (window.scrollY >= sectionTop) {
                current = section.getAttribute('id');
            }
        });
        
        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === '#' + current) {
                link.classList.add('active');
            }
        });
    }
    
    window.addEventListener('scroll', updateActiveNav);
    updateActiveNav(); // Initial call
});
</script>
{% endblock %}
