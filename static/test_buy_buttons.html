<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buy Button Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h2>üß™ Buy Button Functionality Test</h2>
        <p>Click the buy buttons below to test external broker redirects:</p>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <h4>üìà Oslo B√∏rs Stocks</h4>
                <div class="card">
                    <div class="card-body">
                        <h5>EQNR.OL - Equinor</h5>
                        <button class="btn btn-success external-buy-btn" data-ticker="EQNR.OL" data-market="oslo">
                            <i class="bi bi-cart-plus"></i> Kj√∏p EQNR
                        </button>
                        
                        <h5 class="mt-3">DNB.OL - DNB Bank</h5>
                        <button class="btn btn-success external-buy-btn" data-ticker="DNB.OL" data-market="oslo">
                            <i class="bi bi-cart-plus"></i> Kj√∏p DNB
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <h4>üåç Global Stocks</h4>
                <div class="card">
                    <div class="card-body">
                        <h5>AAPL - Apple Inc.</h5>
                        <button class="btn btn-success external-buy-btn" data-ticker="AAPL" data-market="global">
                            <i class="bi bi-cart-plus"></i> Kj√∏p AAPL
                        </button>
                        
                        <h5 class="mt-3">TSLA - Tesla Inc.</h5>
                        <button class="btn btn-success external-buy-btn" data-ticker="TSLA" data-market="global">
                            <i class="bi bi-cart-plus"></i> Kj√∏p TSLA
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-info mt-4">
            <strong>Expected behavior:</strong>
            <ul>
                <li>Oslo stocks should redirect to Nordnet Oslo pages</li>
                <li>Global stocks should redirect to Nordnet international pages</li>
                <li>New tab should open for each purchase link</li>
                <li>Success toast should appear</li>
            </ul>
        </div>
    </div>

    <!-- Toast container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // External buy button functionality
        document.querySelectorAll('.external-buy-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const ticker = this.dataset.ticker;
                const market = this.dataset.market;
                
                // Define broker URLs based on market
                let brokerUrl;
                if (market === 'oslo') {
                    // Norwegian stocks - redirect to Nordnet or DNB
                    brokerUrl = `https://www.nordnet.no/market/stocks/${ticker}.OSE`;
                } else if (market === 'global') {
                    // Global stocks - redirect to international broker
                    brokerUrl = `https://www.nordnet.no/market/stocks/${ticker}`;
                }
                
                if (brokerUrl) {
                    // Open in new tab
                    window.open(brokerUrl, '_blank');
                    showToast(`√Öpner kj√∏psside for ${ticker}`, 'success');
                } else {
                    showToast('Kunne ikke finne kj√∏psside for dette instrumentet', 'error');
                }
            });
        });

        function showToast(message, type) {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type === 'success' ? 'success' : 'danger'} border-0`;
            toast.setAttribute('role', 'alert');
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            // Add to toast container or create one
            let container = document.querySelector('.toast-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(container);
            }
            
            container.appendChild(toast);
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Remove after hidden
            toast.addEventListener('hidden.bs.toast', () => toast.remove());
        }
    </script>
</body>
</html>
